<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.blog.mapper.SearchHistoryMapper">

    <select id="selectByUserId" resultType="com.example.blog.entity.SearchHistory">
        SELECT
            id,
            user_id,
            keyword,
            result_count,
            search_time
        FROM t_search_history
        WHERE user_id = #{userId}
        ORDER BY search_time DESC
    </select>

    <select id="selectRecentByUserId" resultType="com.example.blog.entity.SearchHistory">
        SELECT
            id,
            user_id,
            keyword,
            result_count,
            search_time
        FROM t_search_history
        WHERE user_id = #{userId}
        ORDER BY search_time DESC
        LIMIT #{limit}
    </select>

    <delete id="deleteByUserId">
        DELETE FROM t_search_history
        WHERE user_id = #{userId}
    </delete>

    <delete id="deleteByUserIdBeforeDate">
        DELETE FROM t_search_history
        WHERE user_id = #{userId}
        AND search_time &lt; #{beforeDate}
    </delete>

    <select id="selectPopularKeywordsByUserId" resultType="java.lang.String">
        SELECT keyword
        FROM t_search_history
        WHERE user_id = #{userId}
        GROUP BY keyword
        ORDER BY COUNT(*) DESC, MAX(search_time) DESC
        LIMIT #{limit}
    </select>

</mapper>